(this["webpackJsonpcryptash-client"]=this["webpackJsonpcryptash-client"]||[]).push([[0],{31:function(e,t,a){},32:function(e,t,a){},34:function(e,t,a){},35:function(e,t,a){},43:function(e,t,a){},44:function(e,t,a){},45:function(e,t,a){},50:function(e,t){},51:function(e,t,a){},52:function(e,t,a){},53:function(e,t,a){},54:function(e,t,a){},55:function(e,t,a){},56:function(e,t,a){"use strict";a.r(t);var n=a(1),c=a.n(n),s=a(25),r=a.n(s),o=(a(31),a(32),a(2)),i=a(0),u=c.a.createContext(void 0),d=function(e,t){switch(t.type){case"CHANGE":return{height:window.innerHeight,width:window.innerWidth};default:throw new Error("Unhandled action type: ".concat(t))}},l={width:window.innerWidth,height:window.innerHeight},j=function(e){var t=e.children,a=c.a.useReducer(d,l),n=Object(o.a)(a,2),s={state:n[0],dispatch:n[1]};return Object(i.jsx)(u.Provider,{value:s,children:t})},h=function(){var e=c.a.useContext(u);if(void 0===e)throw new Error("useCount must be used within a CountProvider");return e},m=function(e){var t=e.children,a=h().dispatch;return Object(n.useEffect)((function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px")),window.addEventListener("resize",(function(e){a({type:"CHANGE"});var t=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(t,"px"))}))}),[]),Object(i.jsx)(i.Fragment,{children:t})},_=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,57)).then((function(t){var a=t.getCLS,n=t.getFID,c=t.getFCP,s=t.getLCP,r=t.getTTFB;a(e),n(e),c(e),s(e),r(e)}))},b=a(11),g=a(4),O=a(12),p=a(3),f=(a(34),a(35),function(){return Object(i.jsxs)("div",{className:"lds-roller",children:[Object(i.jsx)("div",{}),Object(i.jsx)("div",{}),Object(i.jsx)("div",{}),Object(i.jsx)("div",{}),Object(i.jsx)("div",{}),Object(i.jsx)("div",{}),Object(i.jsx)("div",{}),Object(i.jsx)("div",{})]})}),x={server_url:"https://chat.ciphen.net/",socket_url:"wss://chat.ciphen.net/"},y=function(){var e=Object(n.useState)({username:"",password:"",key:""}),t=Object(o.a)(e,2),a=t[0],c=t[1],s=Object(n.useState)(0),r=Object(o.a)(s,2),u=r[0],d=r[1],l=Object(n.useState)(!0),j=Object(o.a)(l,2),h=j[0],m=j[1],_=function(e){c(Object(p.a)(Object(p.a)({},a),{},Object(O.a)({},e.target.name,e.target.value)))};return Object(n.useEffect)((function(){localStorage.getItem("token")?fetch(x.server_url+"api/checkAuth",{method:"POST",body:JSON.stringify({token:localStorage.getItem("token")}),headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){200===e.statusCode&&(m(!1),d(2))})):m(!1)}),[]),h?Object(i.jsx)(f,{}):Object(i.jsx)(i.Fragment,{children:Object(i.jsxs)("div",{className:"login_main",children:[Object(i.jsxs)("div",{className:"login_main__header",children:[Object(i.jsx)("h1",{className:"login_main__header___title",children:"Sign in into your account"}),Object(i.jsx)("h2",{className:"login_main__header___undertitle",children:"If you don't have account, sign up using button below"})]}),Object(i.jsx)("div",{className:"login_main__block",children:Object(i.jsx)("form",{className:"login_main__form",onSubmit:function(e){e.preventDefault(),function(e,t,a){0===t?fetch(x.server_url+"api/login",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){200!==e.statusCode?alert(e.message):(localStorage.setItem("token",e.token),a(1))})):null!=e.key&&(localStorage.setItem("key",e.key),localStorage.getItem("key")&&a(2))}(a,u,d)},children:u?1===u?Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("h3",{children:"One more thing"}),Object(i.jsx)("h4",{children:"Please enter your private key"}),Object(i.jsx)("input",{type:"text",className:"login_main__form___privatekey",autoComplete:"off",placeholder:"Private key",onChange:function(e){c(Object(p.a)(Object(p.a)({},a),{},{key:e.target.value}))}},localStorage.getItem("token")),Object(i.jsx)("button",{type:"submit",className:"login_main__form___submit",children:"Login"})]}):Object(i.jsx)(g.a,{to:"/"}):Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("h1",{children:"Cryptash"}),Object(i.jsx)("input",{name:"username",placeholder:"Username",className:"login_main__form___username",onChange:function(e){return _(e)}}),Object(i.jsx)("input",{name:"password",type:"password",placeholder:"Password",className:"login_main__form___password",onChange:function(e){return _(e)}}),Object(i.jsx)("button",{type:"submit",className:"login_main__form___submit",children:"Login"}),Object(i.jsx)(b.b,{to:"/register",children:"Create new account"})]})})})]})})},v=a(14),S=c.a.createContext(void 0),k=function(e,t){var a=t.payload;switch(t.type){case"ADD_MESSAGE":var n=Object(v.a)(e.chats);return n.filter((function(e){return e.chat_id===a.chat_id}))[0].messages=[a],n.filter((function(e){return e.chat_id===a.chat_id}))[0].messageAt=a.date,n.sort((function(e,t){return new Date(t.messageAt?t.messageAt:"").getTime()-new Date(e.messageAt?e.messageAt:"").getTime()})),Object(p.a)(Object(p.a)({},e),{},{chats:n});case"CHANGE_USER":return Object(p.a)({},a);default:throw new Error("Unhandled action type: ".concat(t.type))}},N={username:"",user_id:"",picture:"",pub_key:"",chats:[],addMessageToChat:function(){}},w=function(e){var t=e.children,a=c.a.useReducer(k,N),n=Object(o.a)(a,2),s={state:n[0],dispatch:n[1]};return Object(i.jsx)(S.Provider,{value:s,children:t})},C=function(){var e=c.a.useContext(S);if(void 0===e)throw new Error("useCount must be used within a CountProvider");return e},E=(a(43),function(e){return e.username?e.picture.includes("http")?Object(i.jsx)(i.Fragment,{children:Object(i.jsx)("div",{className:"profile_picture",children:Object(i.jsx)("img",{src:e.picture,alt:"".concat(e.username,"'s profile pic"),className:"profile_picture__img"})})}):Object(i.jsx)(i.Fragment,{children:Object(i.jsx)("div",{className:"profile_picture",style:{background:e.picture},children:Object(i.jsx)("span",{className:"profile_picture__text",children:e.username[0].toUpperCase()})})}):Object(i.jsx)(i.Fragment,{})}),A=(a(44),function(e){h();return Object(i.jsx)(i.Fragment,{children:Object(i.jsxs)("div",{className:"chat_sidebar__header",onClick:function(t){console.log("click"),e.setOpen()},children:[Object(i.jsx)(E,{username:e.user.username,picture:e.user.picture}),Object(i.jsx)("span",{className:"chat_sidebar__header___username",children:e.user.username})]})})}),T=(a(45),a(19)),I=a(10),M=a(8),D=a.n(M),F=function(e){return"Uint8Array"===typeof e?e:Object(I.decodeBase64)(e)},H=function(e,t,a){var n=F(e),c=F(a),s=Object(I.decodeBase64)(t),r=s.slice(0,M.box.nonceLength),o=s.slice(M.box.nonceLength,t.length),i=a?M.box.open(o,r,c,n):M.box.open.after(o,r,n);if(i||(console.error("Couldn't decrypt:"),console.error({messageWithNonce:t,key:a,secretOrSharedKey:e})),i){var u=Object(I.encodeUTF8)(i);return JSON.parse(u)}return{text:""}},G=function(e){var t=new Date;return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()},P=function(e){var t=new Date(e),a=new Intl.RelativeTimeFormat(["en"],{style:"narrow"}),n=new Date,c=n.getTime()-t.getTime();return G(t)?n.getHours()-t.getHours()<2?0===Math.floor(c/1e3/60)?a.format(-Math.round(c/1e3),"seconds"):a.format(-Math.round(c/1e3/60),"minutes"):t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):function(e){var t=new Date;return e.getDate()===t.getDate()-1&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()}(t)?"yesterday":t.toLocaleDateString([],{day:"2-digit",month:"numeric",year:"2-digit"})},R=function(e){var t=new Date(e),a=new Date;return G(t)?!(a.getHours()-t.getHours()<2)&&"today, ".concat(t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})):"".concat(P(t),", ").concat(t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))},L=function(e){var t=e.chat,a=Object(n.useState)(!1),c=Object(o.a)(a,2),s=c[0],r=c[1];return s?Object(i.jsx)(g.a,{to:"/".concat(t.chat_id)}):Object(i.jsx)(i.Fragment,{children:Object(i.jsxs)("div",{className:"chat_list__card",onClick:function(e){return function(e){if(t.chat_id)r(!0);else{var a=new Headers({"Content-Type":"application/json"});a.append("Authorization","".concat(localStorage.getItem("token"))),fetch(x.server_url+"api/chat/create",{method:"POST",body:JSON.stringify({user_id:t.user.user_id}),headers:a}).then((function(e){return e.json()})).then((function(e){200!==e.statusCode?alert(e.message):(t.chat_id=e.chat_id,r(!0))}))}}()},children:[Object(i.jsx)(E,{username:t.user.username,picture:t.user.picture}),Object(i.jsxs)("div",{className:"right",children:[Object(i.jsxs)("div",{className:"chat_list__card___top",children:[Object(i.jsx)("span",{className:"chat_list__card___top____username",children:t.user.username}),Object(i.jsx)("span",{className:"chat_list__card___top____date",children:t.messages[0]&&t.messageAt?R(t.messageAt)?R(t.messageAt):Object(i.jsx)(T.a,{datetime:t.messageAt,opts:{minInterval:5}}):""})]}),Object(i.jsx)("div",{className:"chat_list__card___bottom",children:Object(i.jsx)("span",{className:"chat_list__card___bottom____content",children:t.messages[0]?H(localStorage.getItem("key"),t.messages[0].content,t.user.pub_key).text:""})})]})]})})},J=a(15),U=(a(51),c.a.createContext(void 0)),B=function(e,t){switch(t.type){case"CHANGE_FILTER":return"users"===t.payload.type&&""===t.payload.filter?Object(p.a)(Object(p.a)({},e),{},Object(O.a)({chats:[]},t.payload.type,t.payload.filter)):Object(p.a)(Object(p.a)({},e),{},Object(O.a)({},t.payload.type,t.payload.filter));case"CHANGE_CHATS":return Object(p.a)(Object(p.a)({},e),{},{chats:t.payload.chats});default:throw new Error("Unhandled action type: ".concat(t))}},z={users:"",messages:"",chats:[]},Y=function(e){var t=e.children,a=c.a.useReducer(B,z),n=Object(o.a)(a,2),s={state:n[0],dispatch:n[1]};return Object(i.jsx)(U.Provider,{value:s,children:t})},K=function(){var e=c.a.useContext(U);if(void 0===e)throw new Error("useCount must be used within a CountProvider");return e},W=function(){var e=C().state,t=K(),a=[];return t.state.chats&&t.state.chats.forEach((function(e){a.push(Object(i.jsx)(L,{chat:{chat_id:"",user:e,messages:[]}},Object(J.a)(5)))})),e.chats.forEach((function(e){t.state.users?e.user.username.toLowerCase().includes(t.state.users.toLowerCase())&&a.push(Object(i.jsx)(L,{chat:e},Object(J.a)(5))):a.push(Object(i.jsx)(L,{chat:e},Object(J.a)(5)))})),Object(i.jsx)(i.Fragment,{children:Object(i.jsx)("div",{className:"chat_list",children:a})})},Z=(a(52),function(e){var t=K(),a=Object(n.useRef)(null);return Object(i.jsx)(i.Fragment,{children:Object(i.jsx)("div",{className:"chat_sidebar__search",children:Object(i.jsxs)("div",{className:"chat_sidebar__search___bar",onClick:function(t){e.isOpened||(e.setOpened(!0),null!==a.current&&setTimeout((function(){null!==a.current&&a.current.focus()}),100))},children:[Object(i.jsx)("span",{className:"material-icons outlined",children:"search"}),Object(i.jsx)("input",{type:"text",className:"chat_sidebar__search___bar-input",placeholder:"Search users",ref:a,onChange:function(e){return function(e){if(t.dispatch({type:"CHANGE_FILTER",payload:{type:"users",filter:e.target.value}}),e.target.value.length<3)t.dispatch({type:"CHANGE_CHATS",payload:{chats:[]}});else if(localStorage.getItem("token")){var a=new Headers({"Content-Type":"application/json"});a.append("Authorization","".concat(localStorage.getItem("token"))),fetch(x.server_url+"api/users/search",{method:"POST",body:JSON.stringify({query:e.target.value}),headers:a}).then((function(e){return e.json()})).then((function(e){200!==e.statusCode?alert(e.message):e.data&&t.dispatch({type:"CHANGE_CHATS",payload:{chats:e.data.users}})}))}}(e)}})]})})})}),V=function(e){var t=C().state,a=h(),c=Object(n.useState)(a.state.width>700),s=Object(o.a)(c,2),r=s[0],u=s[1];return Object(n.useEffect)((function(){u(a.state.width>700)}),[a.state]),Object(i.jsx)(i.Fragment,{children:Object(i.jsx)(Y,{children:Object(i.jsxs)("div",{className:"chat_sidebar ".concat(r?"opened":"closed"),children:[Object(i.jsx)(A,{user:{username:t.username,picture:t.picture},setOpen:function(){console.log(!r),u(!r)}}),Object(i.jsx)(Z,{isOpened:r,setOpened:function(e){return u(e)}}),Object(i.jsx)(W,{})]})})})},$=(a(53),function(e){var t=Object(n.useMemo)((function(){try{return H(localStorage.getItem("key"),e.content,e.pub_key).text}catch(t){return console.log({error:t,props:e}),""}}),[e]),a=Object(n.useState)(e.isRead),c=Object(o.a)(a,2),s=c[0],r=c[1],u=Object(n.useRef)(null),d=Object(n.useRef)(!1),l=Object(g.f)(),j=function(){var a;if(!(s||e.fromMe||d.current)){var n=null===(a=u.current)||void 0===a?void 0:a.getBoundingClientRect();n&&n.top>0&&(console.log(e.id),e.socket.send(JSON.stringify({action:"mark_as_read",chatId:l.id,messageId:e.id,token:localStorage.getItem("token")})),d.current=!0,console.log(t),r(!0))}};return Object(n.useEffect)((function(){if(!s&&!e.fromMe)return e.subscribeToScroll(j)();!s&&e.fromMe&&e.socket.addEventListener("message",(function(t){var a=JSON.parse(t.data);"message_read_by_user"===a.action&&a.data.chat_id===l.id&&a.data.message_id===e.id&&r(!0)}))}),[s]),Object(n.useEffect)((function(){j()}),[]),Object(i.jsx)(i.Fragment,{children:Object(i.jsxs)("div",{className:"chat_dialog__messages-message ".concat(e.fromMe?"fromMe":"toMe"),ref:u,children:[Object(i.jsxs)("div",{className:"chat_dialog__messages-message_top ".concat(e.fromMe?"fromMe":"toMe"),children:[Object(i.jsx)("div",{className:"chat_dialog__messages-message_top-bubble ".concat(e.fromMe?"fromMe":"toMe"),children:Object(i.jsx)("span",{children:t})}),Object(i.jsx)("div",{className:"chat_dialog__messages-message_top-context",children:Object(i.jsx)("span",{className:"material-icons",children:"more_horiz"})}),e.fromMe?Object(i.jsx)("div",{className:"chat_dialog__messages-message_top-status",children:Object(i.jsx)("span",{className:"material-icons",children:s?"done_all":"done"})}):""]}),Object(i.jsx)("div",{className:"chat_dialog__messages-message_bottom ".concat(e.fromMe?"fromMe":"toMe"),children:R(e.date)?R(e.date):Object(i.jsx)(T.a,{datetime:e.date,opts:{minInterval:10}})})]})})}),q=(a(54),c.a.createContext(void 0)),Q=function(e,t){var a=t.payload;switch(console.log(t),t.type){case"ADD_MESSAGE":var n;return(n=e.messages).push.apply(n,Object(v.a)(a)),Object(p.a)({},e);case"ADD_MORE_MESSAGES":return e.messages=[].concat(Object(v.a)(a),Object(v.a)(e.messages)),Object(p.a)({},e);case"CHANGE_DIALOG":return{username:"",user_id:"",picture:"",pub_key:"",messages:[]};case"CHANGE_KEY":return e.pub_key=t.payload,e;case"SET_MESSAGE_READ_STATUS":return e.messages.filter((function(e){return e.message_id===a.id}))[0].read=!0,console.log(e),e;case"SET_DIALOG_DATA":return Object(p.a)(Object(p.a)({},e),a);default:throw new Error("Unhandled action type: ".concat(t.type))}},X={username:"",user_id:"",picture:"",pub_key:"",messages:[]},ee=function(e){var t=e.children,a=c.a.useReducer(Q,X),n=Object(o.a)(a,2),s={state:n[0],dispatch:n[1]};return Object(i.jsx)(q.Provider,{value:s,children:t})},te=function(){var e=c.a.useContext(q);if(void 0===e)throw new Error("useCount must be used within a CountProvider");return e},ae=function(e){var t=Object(n.useState)(""),a=Object(o.a)(t,2),c=a[0],s=a[1],r=te().state,u=Object(n.useRef)(null),d=function(t){t.preventDefault();var a=function(e,t,a){var n=F(e),c=F(a),s=D.a.randomBytes(M.box.nonceLength),r=Object(I.decodeUTF8)(JSON.stringify(t)),o=c?Object(M.box)(r,s,c,n):M.box.after(r,s,n),i=new Uint8Array(s.length+o.length);return i.set(s),i.set(o,s.length),Object(I.encodeBase64)(i)}(localStorage.getItem("key"),{text:c},r.pub_key);e.socket.send(JSON.stringify({action:"send_message",chatId:e.chat_id,content:a,token:localStorage.getItem("token")})),u.current&&(u.current.value=""),s("")};return Object(i.jsx)(i.Fragment,{children:Object(i.jsx)("div",{className:"chat_dialog__input",children:Object(i.jsx)("div",{className:"chat_dialog__input-wrap",children:Object(i.jsxs)("form",{action:"",onSubmit:function(e){return d(e)},children:[Object(i.jsx)("input",{type:"text",placeholder:"Write a message...",onInput:function(e){return function(e){s(e.target.value)}(e)},ref:u}),Object(i.jsx)("button",{type:"submit",className:"material-icons",children:"send"})]})})})})},ne=function(e){return Object(i.jsx)(i.Fragment,{children:Object(i.jsx)("div",{className:"chat_dialog__header"})})},ce=function(e){var t=Object(n.useState)(!0),a=Object(o.a)(t,2),c=a[0],s=a[1],r=Object(g.f)(),u=Object(n.useRef)(0),d=Object(n.useRef)(0),l=Object(n.useState)(!1),j=Object(o.a)(l,2),h=j[0],m=j[1],_=te(),b=(C(),Object(n.useState)([])),O=Object(o.a)(b,2),p=O[0],x=O[1],y=Object(n.useRef)(null),v=Object(n.useRef)([]),S=Object(n.useCallback)((function(e){var t=JSON.parse(e.data);"get_messages"===t.action&&(0===u.current?(_.dispatch({type:"CHANGE_DIALOG"}),v.current=[],_.dispatch({type:"CHANGE_KEY",payload:t.pub_key}),_.dispatch({type:"ADD_MESSAGE",payload:t.messages})):t.messages[0]&&(_.dispatch({type:"ADD_MORE_MESSAGES",payload:t.messages}),m(!1)),s(!1)),"new_message"===t.action&&t.data.message.chat_id===r.id&&(console.log(t.data.message.chat_id,r.id),_.dispatch({type:"ADD_MESSAGE",payload:[{content:t.data.message.content,pub_key:_.state.pub_key,date:t.data.message.date,fromMe:t.data.message.isMe,read:t.data.message.read,message_id:t.data.message.message_id}]})),"message_read_by_user"===t.action&&t.data.chat_id===r.id&&_.dispatch({type:"SET_MESSAGE_READ_STATUS",payload:{id:t.data.message_id}})}),[_.state.user_id]);return Object(n.useEffect)((function(){var t=[];_.state.messages.forEach((function(a){return t.push(Object(i.jsx)($,{socket:e.socket,id:a.message_id,subscribeToScroll:function(e){return function(e){return v.current.push(e),function(){return v.current.filter((function(t){return t!==e}))}}(e)},isRead:a.read,content:a.content,pub_key:_.state.pub_key,fromMe:a.fromMe,date:a.date},Object(J.a)(6)))})),x(t)}),[_.state]),Object(n.useEffect)((function(){y.current&&(y.current.scrollTop>1e3||0===u.current)?y.current.scrollTo(0,y.current?y.current.scrollHeight:0):y.current&&y.current.scrollTo(0,y.current?y.current.scrollHeight-d.current:0)}),[p]),Object(n.useEffect)((function(){return e.socket.addEventListener("message",S),_.dispatch({type:"CHANGE_DIALOG"}),u.current=0,s(!0),e.socket.send(JSON.stringify({action:"get_messages",chat_id:r.id,pg:0,jwt:localStorage.getItem("token")})),function(){e.socket.removeEventListener("message",S)}}),[S,r.id,e.socket]),r.id?c?Object(i.jsx)("div",{className:"preloader",children:Object(i.jsx)(f,{})}):Object(i.jsx)(i.Fragment,{children:Object(i.jsxs)("div",{className:"chat_dialog",children:[Object(i.jsx)(ne,{socket:e.socket}),Object(i.jsx)("div",{className:"chat_dialog__messages",onScroll:function(t){return function(t){v.current.forEach((function(e){e(t)})),0===t.target.scrollTop&&(h||(u.current=u.current+1,d.current=y.current?y.current.scrollHeight:0,m(!0),e.socket.send(JSON.stringify({action:"get_messages",chat_id:r.id,pg:u.current,jwt:localStorage.getItem("token")}))))}(t)},ref:y,children:p}),Object(i.jsx)(ae,{socket:e.socket,chat_id:r.id})]})}):Object(i.jsx)("div",{})},se=function(){var e=Object(g.f)(),t=Object(n.useRef)(new WebSocket(x.socket_url)),a=localStorage.getItem("token"),c=C().dispatch,s=Object(n.useState)(!0),r=Object(o.a)(s,2),u=r[0],d=r[1],l=function(e){var t=JSON.parse(e.data);if(console.dir(t),t.data&&("Successful connection"===t.data.message&&console.warn("Socket: Successful connection"),"new_message"===t.action)){var a=t.data.message;c({type:"ADD_MESSAGE",payload:a})}};return Object(n.useEffect)((function(){return t.current.onopen=function(){t.current.send(JSON.stringify({action:"register",jwt:a}))},t.current.addEventListener("message",l),fetch(x.server_url+"api/users/getInfo",{method:"POST",mode:"cors",body:JSON.stringify({}),headers:{Authorization:a||"","Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){if(200!==e.statusCode)console.error(e);else{var t=e.response;c({type:"CHANGE_USER",payload:Object(p.a)({},t)}),d(!1)}})),function(){return t.current.removeEventListener("message",l)}}),[]),void 0===e.id?(console.log("No chat"),Object(i.jsx)("div",{className:"chat",children:Object(i.jsx)(V,{})})):u?Object(i.jsx)(f,{}):Object(i.jsxs)("div",{className:"chat",children:[Object(i.jsx)(V,{}),Object(i.jsx)(ee,{children:Object(i.jsx)(ce,{socket:t.current})})]})},re=function(){var e=Object(n.useState)(0),t=Object(o.a)(e,2),a=t[0],c=t[1],s=localStorage.getItem("token");return Object(n.useEffect)((function(){localStorage.getItem("token")?fetch(x.server_url+"api/checkAuth",{method:"POST",body:JSON.stringify({token:s}),headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){return c(200===e.statusCode?2:1)})):c(1)}),[s]),0===a?Object(i.jsx)(f,{}):1===a?Object(i.jsx)(g.a,{to:"/login"}):Object(i.jsx)(w,{children:Object(i.jsx)(se,{})})},oe=(a(55),function(){var e=Object(n.useState)(function(){var e=M.box.keyPair(),t=e.publicKey,a=e.secretKey;return{public_key:Object(I.encodeBase64)(t),private_key:Object(I.encodeBase64)(a)}}()),t=Object(o.a)(e,2),a=t[0],c=(t[1],Object(n.useState)({username:"",password:""})),s=Object(o.a)(c,2),r=s[0],u=s[1],d=Object(n.useState)(!1),l=Object(o.a)(d,2),j=l[0],h=l[1],m=Object(n.useState)(0),_=Object(o.a)(m,2),y=_[0],v=_[1],S=Object(n.useState)(!1),k=Object(o.a)(S,2),N=k[0],w=k[1],C=Object(n.useState)(!0),E=Object(o.a)(C,2),A=E[0],T=E[1],D=function(e){if(console.log(e.target.name,e.target.value),"verify_password"===e.target.name)e.target.value===r.password?w(!0):w(!1);else if(u(Object(p.a)(Object(p.a)({},r),{},Object(O.a)({},e.target.name,e.target.value))),"password"===e.target.name){e.target.value.match(/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])(?!.*\s).{8,31}$/)?h(!0):h(!1)}},F=Object(n.useRef)(null);return Object(n.useEffect)((function(){localStorage.getItem("token")?fetch(x.server_url+"api/checkAuth",{method:"POST",body:JSON.stringify({token:localStorage.getItem("token")}),headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){200===e.statusCode&&(T(!1),v(2))})):T(!1)}),[]),A?Object(i.jsx)(f,{}):Object(i.jsx)(i.Fragment,{children:Object(i.jsxs)("div",{className:"register_main",children:[Object(i.jsxs)("div",{className:"register_main__header",children:[Object(i.jsx)("h1",{className:"register_main__header___title",children:"Create your account"}),Object(i.jsx)("h2",{className:"register_main__header___undertitle",children:"If you already have an account, login using button below"})]}),Object(i.jsx)("div",{className:"register_main__block",children:Object(i.jsx)("form",{className:"register_main__form",onSubmit:function(e){e.preventDefault(),function(e,t,n){e.password&&e.username&&N&&(e.password.match(/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])(?!.*\s).{8,31}$/),0===t?fetch(x.server_url+"api/register",{method:"POST",body:JSON.stringify(Object(p.a)(Object(p.a)({},e),{},{pub_key:a.public_key})),headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){200!==e.statusCode?alert(e.message):(localStorage.setItem("token",e.token),n(1))})):null!=a.private_key&&(localStorage.setItem("key",a.private_key),localStorage.getItem("key")&&n(2)))}(r,y,v)},children:y?(localStorage.setItem("key",a.private_key),1===y?Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("h3",{children:"One more thing"}),Object(i.jsx)("h4",{children:"Please, write down your private key!"}),Object(i.jsxs)("div",{className:"register_main__form___key-wrapper",children:[Object(i.jsx)("input",{name:"key",type:"text",defaultValue:a.private_key,className:"register_main__form___key-wrapper",ref:F},a.private_key),Object(i.jsx)("span",{className:"material-icons outlined register_main__form___copy",onClick:function(e){F.current&&F.current.select(),document.execCommand("copy")},children:"content_copy"})]}),Object(i.jsx)("button",{type:"submit",className:"register_main__form___submit",children:"Create account"})]}):Object(i.jsx)(g.a,{to:"/"})):Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("h1",{children:"Cryptash"}),Object(i.jsx)("input",{name:"username",placeholder:"Username",className:"register_main__form___username",onChange:function(e){return D(e)}}),Object(i.jsx)("input",{name:"password",type:"password",placeholder:"Password",className:"register_main__form___password ".concat(j?"":"red-outline"),onChange:function(e){return D(e)}}),Object(i.jsx)("input",{name:"verify_password",type:"password",placeholder:"Verify Password",className:"register_main__form___password ".concat(N?"":"red-outline"),onChange:function(e){return D(e)}}),Object(i.jsx)("button",{type:"submit",className:"register_main__form___submit",disabled:!N,children:"Create account"}),Object(i.jsx)(b.b,{to:"/login",children:"Back to login"})]})})})]})})});r.a.render(Object(i.jsx)(c.a.StrictMode,{children:Object(i.jsx)(j,{children:Object(i.jsx)(b.a,{children:Object(i.jsxs)(m,{children:[Object(i.jsx)(g.b,{exact:!0,path:"/login",component:y}),Object(i.jsx)(g.b,{exact:!0,path:"/register",component:oe}),Object(i.jsx)(g.b,{path:["/:id","/"],exact:!0,component:re})]})})})}),document.getElementById("root")),_()}},[[56,1,2]]]);
//# sourceMappingURL=main.cd98e813.chunk.js.map