(this["webpackJsonpcryptash-client"]=this["webpackJsonpcryptash-client"]||[]).push([[0],{171:function(e,t,a){},172:function(e,t,a){},174:function(e,t,a){},180:function(e,t){},182:function(e,t){},192:function(e,t){},194:function(e,t){},221:function(e,t){},223:function(e,t){},224:function(e,t){},229:function(e,t){},231:function(e,t){},237:function(e,t){},239:function(e,t){},258:function(e,t){},270:function(e,t){},273:function(e,t){},307:function(e,t,a){},308:function(e,t,a){},309:function(e,t,a){},310:function(e,t,a){},311:function(e,t){},313:function(e,t,a){},314:function(e,t,a){},315:function(e,t,a){},316:function(e,t,a){},317:function(e,t,a){},318:function(e,t,a){"use strict";a.r(t);var c=a(1),s=a.n(c),n=a(72),r=a.n(n),o=(a(171),a(172),a(4)),i=a(0),u=s.a.createContext(void 0),d=function(e,t){switch(t.type){case"CHANGE":return{height:window.innerHeight,width:window.innerWidth};default:throw new Error("Unhandled action type: ".concat(t))}},l={width:window.innerWidth,height:window.innerHeight},h=function(e){var t=e.children,a=s.a.useReducer(d,l),c=Object(o.a)(a,2),n={state:c[0],dispatch:c[1]};return Object(i.jsx)(u.Provider,{value:n,children:t})},j=function(){var e=s.a.useContext(u);if(void 0===e)throw new Error("useCount must be used within a CountProvider");return e},m=function(e){var t=e.children,a=j().dispatch;return Object(c.useEffect)((function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px")),window.addEventListener("resize",(function(e){a({type:"CHANGE"});var t=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(t,"px"))}))}),[]),Object(i.jsx)(i.Fragment,{children:t})},_=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,326)).then((function(t){var a=t.getCLS,c=t.getFID,s=t.getFCP,n=t.getLCP,r=t.getTTFB;a(e),c(e),s(e),n(e),r(e)}))},g=a(32),b=a(10),p=a(33),f=a(5),O=(a(174),{server_url:"https://chat.ciphen.net/",socket_url:"wss://chat.ciphen.net:31337/"}),y=a(55),x=a(165),v=a(324),S=a(322),w=a(321),E={user_id:"",username:"",pub_key:"",picture:"",chats:[]},N=a(75),k=a(163),C=a.n(k),A=a(16),M={username:"",user_id:"",picture:"",pub_key:"",chat_id:"",messages:[]},I=C()(),R=I("chat/change"),D=I("chat/set_id"),F=I("chat/messages/get"),T=I("chat/message/read"),H=I("users/search"),G=I("chat/create"),L=I("chat/messages/send"),P=Object(N.a)({userReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"login/done":return localStorage.setItem("token",t.payload.token),e;case"chat/message/create":var a=e.chats.filter((function(e){return e.chat_id===t.payload.chat_id}));if(console.log(a),a[0]){var c=e.chats.indexOf(a[0]);a[0].messages[0]={content:t.payload.content,read:t.payload.read,date:t.payload.date,message_id:t.payload.message_id,fromMe:t.payload.from===localStorage.getItem("user_id")},a[0].messageAt=t.payload.date,0!==c&&(e.chats=e.chats.filter((function(e){return e!==a[0]})),e.chats.unshift(a[0]))}return e;case"user/get_info/done":return t.payload;default:return e}},chatReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,t=arguments.length>1?arguments[1]:void 0,a=t.payload;switch(t.type){case"chat/message/add":var c;return console.log("NEW MESSAGE"),(c=e.messages).push.apply(c,Object(A.a)(a)),Object(f.a)({},e);case"chat/load_messages/done":return e.messages=[].concat(Object(A.a)(a.messages),Object(A.a)(e.messages)),e.pub_key=a.pub_key,Object(f.a)({},e);case"chat/change":return{username:"",user_id:"",picture:"",pub_key:"",chat_id:t.payload.id,messages:[]};case"chat/messages/send":return console.log(t.payload),e.messages.push({content:t.payload.content,read:!1,date:new Date,message_id:"",fromMe:!0}),console.log(e.messages),e;case"chat/message/setId":return e.chat_id===t.payload.chat_id&&(e.messages[e.messages.length-1].message_id=t.payload.id),e;case"chat/message/create":return e.chat_id===t.payload.chat_id&&t.payload.from!==localStorage.getItem("user_id")&&(e.messages.filter((function(e){return t.payload.message_id===e.message_id}))[0]||e.messages.push({content:t.payload.content,read:t.payload.read,date:t.payload.date,message_id:t.payload.message_id,fromMe:t.payload.from===localStorage.getItem("user_id")})),e;case"chat/change_key":return e.pub_key=t.payload,e;case"chat/set_id":return e.chat_id=t.payload.id,console.log(e),e;case"chat/message/read":return t.payload.chat_id===e.chat_id&&(e.messages.filter((function(e){return e.message_id===t.payload.message_id}))[0].read=!0),e;case"chat/data/set":return Object(f.a)(Object(f.a)({},e),a);default:return e}}}),U=localStorage.getItem("user_id")||"anonymous",B=localStorage.getItem("token")||"",z=new v.a({subprotocol:"1.0.0",server:O.socket_url,userId:U,token:B}),W=Object(w.a)(z)(P);Object(S.a)(W.client);var Y=W;var J=function(){var e=Object(c.useState)({username:"",password:"",key:""}),t=Object(o.a)(e,2),a=t[0],s=t[1],n=Object(c.useState)(0),r=Object(o.a)(n,2),u=(r[0],r[1],function(e){s(Object(f.a)(Object(f.a)({},a),{},Object(p.a)({},e.target.name,e.target.value)))}),d=Object(b.f)();return Object(i.jsx)(i.Fragment,{children:Object(i.jsxs)("div",{className:"login_main",children:[Object(i.jsxs)("div",{className:"login_main__header",children:[Object(i.jsx)("h1",{className:"login_main__header___title",children:"Sign in into your account"}),Object(i.jsx)("h2",{className:"login_main__header___undertitle",children:"If you don't have account, sign up using button below"})]}),Object(i.jsx)("div",{className:"login_main__block",children:Object(i.jsx)("form",{className:"login_main__form",onSubmit:function(e){e.preventDefault(),function(e,t,a){var c=new x.a({subprotocol:"1.0.0",server:O.socket_url,userId:"anonymous"});c.on("add",(function(e){"login/done"===e.type?(localStorage.setItem("user_id",e.user_id),localStorage.setItem("token",e.token),localStorage.setItem("key",y.AES.decrypt(e.private_key,t).toString(y.enc.Utf8)),Y.client.changeUser(e.user_id,e.token),a("/")):"logux/undo"===e.type&&alert(e.reason)})),c.start(),c.log.add({type:"login",username:e,password:t},{sync:!0})}(a.username,a.password,(function(e){return d.push(e)}))},children:Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("h1",{children:"Cryptash"}),Object(i.jsx)("input",{name:"username",placeholder:"Username",className:"login_main__form___username",onChange:function(e){return u(e)}}),Object(i.jsx)("input",{name:"password",type:"password",placeholder:"Password",className:"login_main__form___password",onChange:function(e){return u(e)}}),Object(i.jsx)("button",{type:"submit",className:"login_main__form___submit",children:"Login"}),Object(i.jsx)(g.b,{to:"/register",children:"Create new account"})]})})})]})})},K=(a(307),function(){return Object(i.jsxs)("div",{className:"lds-roller",children:[Object(i.jsx)("div",{}),Object(i.jsx)("div",{}),Object(i.jsx)("div",{}),Object(i.jsx)("div",{}),Object(i.jsx)("div",{}),Object(i.jsx)("div",{}),Object(i.jsx)("div",{}),Object(i.jsx)("div",{})]})}),Z=(a(308),function(e){return e.username?e.picture.includes("http")?Object(i.jsx)(i.Fragment,{children:Object(i.jsx)("div",{className:"profile_picture",children:Object(i.jsx)("img",{src:e.picture,alt:"".concat(e.username,"'s profile pic"),className:"profile_picture__img"})})}):Object(i.jsx)(i.Fragment,{children:Object(i.jsx)("div",{className:"profile_picture",style:{background:e.picture},children:Object(i.jsx)("span",{className:"profile_picture__text",children:e.username[0].toUpperCase()})})}):Object(i.jsx)(i.Fragment,{})}),$=(a(309),function(e){j();return Object(i.jsx)(i.Fragment,{children:Object(i.jsxs)("div",{className:"chat_sidebar__header",onClick:function(t){console.log("click"),e.setOpen()},children:[Object(i.jsx)(Z,{username:e.user.username,picture:e.user.picture}),Object(i.jsx)("span",{className:"chat_sidebar__header___username",children:e.user.username})]})})}),q=(a(310),a(74)),V=a(30),Q=a(26),X=a.n(Q),ee=function(e){return"Uint8Array"===typeof e?e:Object(V.decodeBase64)(e)},te=function(e,t,a){var c=ee(e),s=ee(a),n=Object(V.decodeBase64)(t),r=n.slice(0,Q.box.nonceLength),o=n.slice(Q.box.nonceLength,t.length),i=a?Q.box.open(o,r,s,c):Q.box.open.after(o,r,c);if(i||(console.error("Couldn't decrypt:"),console.error({messageWithNonce:t,key:a,secretOrSharedKey:e})),i){var u=Object(V.encodeUTF8)(i);return JSON.parse(u)}return{text:""}},ae=function(e){var t=new Date;return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()},ce=function(e){var t=new Date(e),a=new Intl.RelativeTimeFormat(["en"],{style:"narrow"}),c=new Date,s=c.getTime()-t.getTime();return ae(t)?c.getHours()-t.getHours()<2?0===Math.floor(s/1e3/60)?a.format(-Math.round(s/1e3),"seconds"):a.format(-Math.round(s/1e3/60),"minutes"):t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):function(e){var t=new Date;return e.getDate()===t.getDate()-1&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()}(t)?"yesterday":t.toLocaleDateString([],{day:"2-digit",month:"numeric",year:"2-digit"})},se=function(e){var t=new Date(e),a=new Date;return ae(t)?!(a.getHours()-t.getHours()<2)&&"today, ".concat(t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})):"".concat(ce(t),", ").concat(t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))},ne=a(19),re=function(e){var t=e.chat,a=Object(c.useState)(!1),s=Object(o.a)(a,2),n=(s[0],s[1],Object(b.f)()),r=Object(ne.d)();Object(c.useEffect)((function(){Y.client.log.type("chat/create/done",(function(e,t){n.push("/".concat(e.payload.chat_id))}))}),[]),console.log(t.user.username,t.messages[0]?t.messages[0].date:"");return Object(i.jsx)(i.Fragment,{children:Object(i.jsxs)("div",{className:"chat_list__card",onClick:function(e){t.chat_id?n.push("/".concat(t.chat_id)):r.sync(G({user_id:t.user.user_id}))},children:[Object(i.jsx)(Z,{username:t.user.username,picture:t.user.picture}),Object(i.jsxs)("div",{className:"right",children:[Object(i.jsxs)("div",{className:"chat_list__card___top",children:[Object(i.jsx)("span",{className:"chat_list__card___top____username",children:t.user.username}),Object(i.jsx)("span",{className:"chat_list__card___top____date",children:t.messages[0]&&t.messageAt?se(t.messageAt)?se(t.messageAt):Object(i.jsx)(q.a,{datetime:t.messageAt,opts:{minInterval:5}}):""})]}),Object(i.jsx)("div",{className:"chat_list__card___bottom",children:Object(i.jsx)("span",{className:"chat_list__card___bottom____content",children:function(){if(t.messages[0])try{return te(localStorage.getItem("key"),t.messages[0].content,t.user.pub_key).text}catch(e){return console.info(e.text),""}return""}()})})]})]})})},oe=a(38),ie=(a(313),s.a.createContext(void 0)),ue=function(e,t){switch(t.type){case"CHANGE_FILTER":return"users"===t.payload.type&&""===t.payload.filter?Object(f.a)(Object(f.a)({},e),{},Object(p.a)({chats:[]},t.payload.type,t.payload.filter)):Object(f.a)(Object(f.a)({},e),{},Object(p.a)({},t.payload.type,t.payload.filter));case"CHANGE_CHATS":return Object(f.a)(Object(f.a)({},e),{},{chats:t.payload.chats});default:throw new Error("Unhandled action type: ".concat(t))}},de={users:"",messages:"",chats:[]},le=function(e){var t=e.children,a=s.a.useReducer(ue,de),c=Object(o.a)(a,2),n={state:c[0],dispatch:c[1]};return Object(i.jsx)(ie.Provider,{value:n,children:t})},he=function(){var e=s.a.useContext(ie);if(void 0===e)throw new Error("useCount must be used within a CountProvider");return e},je=function(){var e=he(),t=(Object(c.useRef)(Y.getState().userReducer.chats),Object(c.useState)([])),a=Object(o.a)(t,2),s=a[0],n=a[1],r=function(t){var a=[];e.state.chats&&e.state.chats.forEach((function(e){a.push(Object(i.jsx)(re,{chat:{chat_id:"",user:e,messages:[]}},Object(oe.a)(5)))})),t.forEach((function(t){e.state.users?t.user.username.toLowerCase().includes(e.state.users.toLowerCase())&&a.push(Object(i.jsx)(re,{chat:t},t.chat_id)):a.push(Object(i.jsx)(re,{chat:t},t.chat_id))})),a!==s&&n(a)};return Object(c.useEffect)((function(){r(Y.getState().userReducer.chats),Y.subscribe((function(){r(Y.getState().userReducer.chats)}))}),[]),Object(c.useEffect)((function(){r(Y.getState().userReducer.chats)}),[e.state]),Object(i.jsx)(i.Fragment,{children:Object(i.jsx)("div",{className:"chat_list",children:s})})},me=(a(314),function(e){var t=he(),a=Object(c.useRef)(null),s=Object(ne.d)();Object(c.useEffect)((function(){Y.client.log.type("users/search/done",(function(e,a){t.dispatch({type:"CHANGE_CHATS",payload:{chats:e.payload.users}})}))}),[]);return Object(i.jsx)(i.Fragment,{children:Object(i.jsx)("div",{className:"chat_sidebar__search",children:Object(i.jsxs)("div",{className:"chat_sidebar__search___bar",onClick:function(t){e.isOpened||null!==a.current&&setTimeout((function(){e.setOpened(!0),null!==a.current&&a.current.focus()}),100)},children:[Object(i.jsx)("span",{className:"material-icons outlined",children:"search"}),Object(i.jsx)("input",{type:"text",className:"chat_sidebar__search___bar-input",placeholder:"Search users",ref:a,onChange:function(e){return function(e){t.dispatch({type:"CHANGE_FILTER",payload:{type:"users",filter:e.target.value}}),e.target.value.length<3?t.dispatch({type:"CHANGE_CHATS",payload:{chats:[]}}):s.sync(H({query:e.target.value}))}(e)}})]})})})}),_e=Object(ne.c)((function(e){return{user:e.userReducer,chat:e.chatReducer}}),(function(e){return{changeChat:function(t){e(R({id:t}))},getMessages:function(t,a){e(F({pg:t,chat_id:a}))},setChatId:function(t){e(D({id:t}))},sendMessage:function(t,a,c){e.sync(L({content:t,chat_id:a,from:c}))}}})),ge=_e((function(e){var t=j(),a=Object(c.useState)(t.state.width>700),s=Object(o.a)(a,2),n=s[0],r=s[1];return Object(c.useEffect)((function(){r(t.state.width>700)}),[t.state]),Object(i.jsx)(i.Fragment,{children:Object(i.jsx)(le,{children:Object(i.jsxs)("div",{className:"chat_sidebar ".concat(n?"opened":"closed"),children:[Object(i.jsx)($,{user:{username:e.user.username,picture:e.user.picture},setOpen:function(){console.log(!n),r(!n)}}),Object(i.jsx)(me,{isOpened:n,setOpened:function(e){return r(e)}}),Object(i.jsx)(je,{})]})})})})),be=(a(315),function(e){var t=Object(ne.e)((function(e){return e.chatReducer.pub_key})),a=Object(c.useMemo)((function(){try{return te(localStorage.getItem("key"),e.content,t).text}catch(a){return console.log({error:a,props:e}),""}}),[e]),s=Object(c.useState)(e.isRead),n=Object(o.a)(s,2),r=n[0],u=n[1],d=Object(c.useRef)(null),l=Object(c.useRef)(!1),h=(Object(b.g)(),Object(ne.e)((function(e){return e.chatReducer}))),j=Object(ne.d)();return Object(c.useEffect)((function(){}),[r]),Object(c.useEffect)((function(){!function(){var t;if(!(r||e.fromMe||l.current)){var a=null===(t=d.current)||void 0===t?void 0:t.getBoundingClientRect();a&&a.top>0&&(console.log("message read by me "+e.id),l.current=!0,j.sync(T({chat_id:h.chat_id,message_id:e.id})).then((function(){return l.current=!1})),u(!0))}}()}),[]),Object(i.jsx)(i.Fragment,{children:Object(i.jsxs)("div",{className:"chat_dialog__messages-message ".concat(e.fromMe?"fromMe":"toMe"),ref:d,children:[Object(i.jsxs)("div",{className:"chat_dialog__messages-message_top ".concat(e.fromMe?"fromMe":"toMe"),children:[Object(i.jsx)("div",{className:"chat_dialog__messages-message_top-bubble ".concat(e.fromMe?"fromMe":"toMe"),children:Object(i.jsx)("span",{children:a})}),Object(i.jsx)("div",{className:"chat_dialog__messages-message_top-context",children:Object(i.jsx)("span",{className:"material-icons",children:"more_horiz"})}),e.fromMe?Object(i.jsx)("div",{className:"chat_dialog__messages-message_top-status",children:Object(i.jsx)("span",{className:"material-icons",children:r?"done_all":"done"})}):""]}),Object(i.jsx)("div",{className:"chat_dialog__messages-message_bottom ".concat(e.fromMe?"fromMe":"toMe"),children:se(e.date)?se(e.date):Object(i.jsx)(q.a,{datetime:e.date,opts:{minInterval:10}})})]})})}),pe=(a(316),_e((function(e){var t=Object(c.useState)(""),a=Object(o.a)(t,2),s=a[0],n=a[1],r=Object(c.useRef)(null),u=function(t){console.log(e.chat),t.preventDefault();var a=function(e,t,a){var c=ee(e),s=ee(a),n=X.a.randomBytes(Q.box.nonceLength),r=Object(V.decodeUTF8)(JSON.stringify(t)),o=s?Object(Q.box)(r,n,s,c):Q.box.after(r,n,c),i=new Uint8Array(n.length+o.length);return i.set(n),i.set(o,n.length),Object(V.encodeBase64)(i)}(localStorage.getItem("key"),{text:s},e.chat.pub_key);e.sendMessage(a,e.chat.chat_id,localStorage.getItem("user_id")),r.current&&(r.current.value=""),n("")};return Object(i.jsx)(i.Fragment,{children:Object(i.jsx)("div",{className:"chat_dialog__input",children:Object(i.jsx)("div",{className:"chat_dialog__input-wrap",children:Object(i.jsxs)("form",{action:"",onSubmit:function(e){return u(e)},children:[Object(i.jsx)("input",{type:"text",placeholder:"Write a message...",onInput:function(e){return function(e){n(e.target.value)}(e)},ref:r}),Object(i.jsx)("button",{type:"submit",className:"material-icons",children:"send"})]})})})})}))),fe=s.a.createContext(void 0),Oe=function(e,t){var a=t.payload;switch(console.log(t),t.type){case"ADD_MESSAGE":var c;return console.log("NEW MESSAGE"),(c=e.messages).push.apply(c,Object(A.a)(a)),Object(f.a)({},e);case"ADD_MORE_MESSAGES":return e.messages=[].concat(Object(A.a)(a),Object(A.a)(e.messages)),Object(f.a)({},e);case"CHANGE_DIALOG":return{username:"",user_id:"",picture:"",pub_key:"",messages:[]};case"CHANGE_KEY":return e.pub_key=t.payload,e;case"SET_MESSAGE_READ_STATUS":return e.messages.filter((function(e){return e.message_id===a.id}))[0].read=!0,console.log(e),e;case"SET_DIALOG_DATA":return Object(f.a)(Object(f.a)({},e),a);default:throw new Error("Unhandled action type: ".concat(t.type))}},ye={username:"",user_id:"",picture:"",pub_key:"",messages:[]},xe=function(e){var t=e.children,a=s.a.useReducer(Oe,ye),c=Object(o.a)(a,2),n={state:c[0],dispatch:c[1]};return Object(i.jsx)(fe.Provider,{value:n,children:t})},ve=function(e){return Object(i.jsx)(i.Fragment,{children:Object(i.jsx)("div",{className:"chat_dialog__header"})})},Se=a(323),we=_e((function(e){var t=Object(b.g)(),a=Object(ne.d)(),n=Object(c.useRef)(0),r=Object(c.useRef)(0),u=Object(c.useState)(!1),d=Object(o.a)(u,2),l=d[0],h=d[1],j=function(){var e=s.a.useContext(fe);if(void 0===e)throw new Error("useCount must be used within a CountProvider");return e}(),m=Object(Se.a)(["chat/".concat(t.id)]),_=Object(ne.e)((function(e){return e.chatReducer})),g=Object(c.useState)([]),p=Object(o.a)(g,2),O=p[0],y=p[1],x=Object(c.useRef)(null),v=Object(c.useRef)([]),S=function(e){return v.current.push(e),function(){return v.current.filter((function(t){return t!==e}))}};Object(c.useEffect)((function(){e.setChatId(t.id)}),[]),Object(c.useEffect)((function(){e.changeChat(t.id)}),[t.id]);Object(c.useCallback)((function(e,t){var a=JSON.parse(e.data);"get_messages"===a.action&&(0===n.current?(j.dispatch({type:"CHANGE_DIALOG"}),v.current=[],j.dispatch({type:"CHANGE_KEY",payload:a.pub_key}),j.dispatch({type:"ADD_MESSAGE",payload:a.messages})):a.messages[0]&&(j.dispatch({type:"ADD_MORE_MESSAGES",payload:a.messages}),h(!1))),"new_message"===a.action&&(console.log(a.data.message.chat_id,t),a.data.message.chat_id===t&&j.dispatch({type:"ADD_MESSAGE",payload:[{content:a.data.message.content,pub_key:j.state.pub_key,date:a.data.message.date,fromMe:a.data.message.isMe,read:a.data.message.read,message_id:a.data.message.message_id}]})),"message_read_by_user"===a.action&&a.data.chat_id===t&&j.dispatch({type:"SET_MESSAGE_READ_STATUS",payload:{id:a.data.message_id}})}),[j.state.user_id]);return Object(c.useEffect)((function(){Y.subscribe((function(){var t=Y.getState().chatReducer,a=[];t.messages.forEach((function(t){return a.push(Object(i.jsx)(be,{socket:e.socket,id:t.message_id,subscribeToScroll:function(e){return S(e)},isRead:t.read,content:t.content,pub_key:e.chat.pub_key,fromMe:t.fromMe,date:t.date},t.message_id))})),y(a)}));var t=[];_.messages.forEach((function(a){return t.push(Object(i.jsx)(be,{socket:e.socket,id:a.message_id,subscribeToScroll:function(e){return S(e)},isRead:a.read,content:a.content,pub_key:e.chat.pub_key,fromMe:a.fromMe,date:a.date},Object(oe.a)(6)))})),y(t)}),[_]),Object(c.useEffect)((function(){x.current&&(x.current.scrollTop>1e3||0===n.current)?x.current.scrollTo(0,x.current?x.current.scrollHeight:0):x.current&&x.current.scrollTo(0,x.current?x.current.scrollHeight-r.current:0)}),[O,m]),t.id?m?Object(i.jsx)("div",{className:"preloader",children:Object(i.jsx)(K,{})}):Object(i.jsx)(i.Fragment,{children:Object(i.jsxs)("div",{className:"chat_dialog",children:[Object(i.jsx)(ve,{socket:e.socket}),Object(i.jsx)("div",{className:"chat_dialog__messages",onScroll:function(e){return function(e){v.current.forEach((function(t){t(e)})),0===e.target.scrollTop&&(l||(n.current=n.current+1,r.current=x.current?x.current.scrollHeight:0,h(!0),a.sync(F({pg:n.current,chat_id:t.id})).then((function(){return h(!1)}))))}(e)},ref:x,children:O}),Object(i.jsx)(pe,Object(f.a)({},e))]})}):Object(i.jsx)("div",{})})),Ee=_e((function(e){var t=Object(b.g)(),a=Object(Se.a)(["user/".concat(localStorage.getItem("user_id"))]);return void 0===t.id?(console.log("No chat"),Object(i.jsx)(ne.a,{store:Y,children:Object(i.jsx)("div",{className:"chat",children:Object(i.jsx)(ge,{})})})):a?Object(i.jsx)(K,{}):Object(i.jsx)(ne.a,{store:Y,children:Object(i.jsxs)("div",{className:"chat",children:[Object(i.jsx)(ge,{}),Object(i.jsx)(xe,{children:Object(i.jsx)(we,{})})]})})})),Ne=a(325),ke=a(166);Object(Ne.a)(Y.client,{messages:{synchronized:"Sent all unsent messages.",disconnected:"No connection to server.",wait:"Waiting...",sending:"Sending...",error:"Error occurred. Please, try again!",protocolError:"Error occurred. Please, contact admins!",syncError:"Error while syncing...",denied:"Access denied"},styles:ke.a});var Ce=function(){var e=Object(c.useState)(0),t=Object(o.a)(e,2),a=t[0],s=t[1],n=localStorage.getItem("token");return Object(c.useEffect)((function(){if(localStorage.getItem("token")){var e=new x.a({subprotocol:"1.0.0",server:O.socket_url,userId:"anonymous"});e.on("add",(function(e){"user/check/done"===e.type?(Y.client.start(),s(2)):"logux/undo"===e.type&&s(0)})),e.start(),e.log.add({type:"user/check",token:localStorage.getItem("token")},{sync:!0})}else s(1)}),[n]),0===a?Object(i.jsx)(K,{}):1===a?Object(i.jsx)(b.a,{to:"/login"}):Object(i.jsx)(ne.a,{store:Y,children:Object(i.jsx)(Ee,{})})},Ae=(a(317),function(){var e=Object(c.useState)(function(){var e=Q.box.keyPair(),t=e.publicKey,a=e.secretKey;return{public_key:Object(V.encodeBase64)(t),private_key:Object(V.encodeBase64)(a)}}()),t=Object(o.a)(e,2),a=t[0],s=(t[1],Object(c.useState)({username:"",password:""})),n=Object(o.a)(s,2),r=n[0],u=n[1],d=Object(c.useState)(!1),l=Object(o.a)(d,2),h=l[0],j=l[1],m=Object(c.useState)(!1),_=Object(o.a)(m,2),v=_[0],S=_[1],w=Object(b.f)(),E=function(e){if(console.log(e.target.name,e.target.value),"verify_password"===e.target.name)e.target.value===r.password?S(!0):S(!1);else if(u(Object(f.a)(Object(f.a)({},r),{},Object(p.a)({},e.target.name,e.target.value))),"password"===e.target.name){e.target.value.match(/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])(?!.*\s).{8,31}$/)?j(!0):j(!1)}};return Object(i.jsx)(i.Fragment,{children:Object(i.jsxs)("div",{className:"register_main",children:[Object(i.jsxs)("div",{className:"register_main__header",children:[Object(i.jsx)("h1",{className:"register_main__header___title",children:"Create your account"}),Object(i.jsx)("h2",{className:"register_main__header___undertitle",children:"If you already have an account, login using button below"})]}),Object(i.jsx)("div",{className:"register_main__block",children:Object(i.jsx)("form",{className:"register_main__form",onSubmit:function(e){e.preventDefault(),function(e,t,a){if(t&&e&&v&&h)if(e.length<3)alert("Username must be at least 3 symbols");else if(t.match(/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])(?!.*\s).{8,31}$/)){var c=new x.a({subprotocol:"1.0.0",server:O.socket_url,userId:"anonymous"});c.on("add",(function(e){"register/done"===e.type?(localStorage.setItem("user_id",e.user_id),localStorage.setItem("token",e.token),localStorage.setItem("key",a.private_key),Y.client.changeUser(e.user_id,e.token),w.push("/")):"logux/undo"===e.type&&alert(e.reason)})),c.start(),c.log.add({type:"register",username:e,password:t,private_key:y.AES.encrypt(a.private_key,t).toString(),pub_key:a.public_key},{sync:!0})}else j(!1)}(r.username,r.password,a)},children:Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("h1",{children:"Cryptash"}),Object(i.jsx)("input",{name:"username",placeholder:"Username",className:"register_main__form___username",onChange:function(e){return E(e)}}),Object(i.jsx)("input",{name:"password",type:"password",placeholder:"Password",className:"register_main__form___password ".concat(h?"":"red-outline"),onChange:function(e){return E(e)}}),Object(i.jsx)("input",{name:"verify_password",type:"password",placeholder:"Verify Password",className:"register_main__form___password ".concat(v?"":"red-outline"),onChange:function(e){return E(e)}}),Object(i.jsx)("button",{type:"submit",className:"register_main__form___submit",disabled:!v,children:"Create account"}),Object(i.jsx)(g.b,{to:"/login",children:"Back to login"})]})})})]})})});r.a.render(Object(i.jsx)(s.a.StrictMode,{children:Object(i.jsx)(h,{children:Object(i.jsx)(g.a,{children:Object(i.jsxs)(m,{children:[Object(i.jsx)(b.b,{exact:!0,path:"/login",component:J}),Object(i.jsx)(b.b,{exact:!0,path:"/register",component:Ae}),Object(i.jsx)(b.b,{path:["/:id","/"],exact:!0,component:Ce})]})})})}),document.getElementById("root")),_()}},[[318,1,2]]]);
//# sourceMappingURL=main.d416b505.chunk.js.map